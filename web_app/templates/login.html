<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Lightstick | Login</title>

    <!--Bootstrap CSS-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

    <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    <!--Bootstrap icons-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>

  <body>
	<!-- <div class="d-flex bg-warning align-items-end align-middle"> -->
    <div class="d-flex align-items-center justify-content-center fill">
	<div>
	    <div class="text-center p-2">
		<h1>lighting_project</h1>
	    </div>
    <!-- </div> -->
    <!-- <div class="row align-items-center d-flex fill"> -->
	    <div>
		<div id="login-section" class="h-auto px-3 py-4 border border-white">
		    <!-- <h1>lighting_project</h1> -->
		    <!-- <br> -->
		    <h2>Sign in</h2>
		    <form id="login-form" action="" autocomplete="off">
			<label for="username" class="form-label">Username:</label>
			<input type="text" id="login-username" name="username" class="form-control text-input bg-transparent border-0 border-bottom text-light" value="">
			<div id="invalid-input-username" class="invisible input-error mt-1">
			    <span class="fw-bolder text-danger">Please provide a username</span>
			</div>
			<br>
			<label for="password" class="form-label">Password:</label>
			<input type="password" class="form-control text-input bg-transparent border-0 border-bottom text-light" id="login-password" name="password" value="">
			<div id="invalid-input-password" class="invisible input-error mt-1">
			    <span class="fw-bolder text-danger">Please enter a password</span>
			</div>
		    </form>
		    <br>
	    <!-- </div> -->
	    <!-- <div> -->
		    <div class="d-grid">
			<button class="btn btn-primary" id="form-btn" value="Submit">Submit</button>
		    </div>
		</div>
	    </div>
	</div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
    <script>
	function onFormSubmit(){
	    var fields = ["username","password"];
	    let isValid = true;
	    $.each(fields, function(index,key){
		//alert(key);
		let value = $("#login-" + key).val();
		//alert(value);
		if(value.length === 0){
		    //alert("Input error");
		    isValid = false
		    $("#invalid-input-"+key).removeClass("invisible");
		    $("#login-"+key).addClass("is-invalid");
		}else{
		    //alert("Input success");
		    $("#invalid-input-"+key).addClass("invisible");
		    $("#login-"+key).removeClass("is-invalid");
		}
	    });
	    
	    if(isValid){
		let username = $("#login-username").val();
		let password = $("#login-password").val();
		login(username,password);
	    }
	}
	
	function login(username,password){
	    //alert(username);
	    //alert(password);
	    $.ajax({
            url: `validate`,
            method: "POST",
            data: {"username": username, "password":password},
            success: function(res) {
		if(res["status"] != 200){
		    alert(res["message"]);
		}else{
		    window.location.replace(res["message"]);
		}
		console.log(res);
	    },
            error: function (err) {
              console.log(err);
              alert("Something went wrong on the server...");
            }
          });
	}
	
	$(document).on("click", "#form-btn", onFormSubmit);
    </script>
  </body>
</html>
